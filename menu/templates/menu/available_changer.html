{% extends "menu/base.html" %}
{% block content %}
    <style>
  /* === Przyciski na górze: aktywny zawsze żółty z ciemnym tekstem === */
  .top-actions .btn { border-width: 2px; }
  .top-actions .btn.active,
  .top-actions .btn:focus,
  .top-actions .btn:active,
  .top-actions .btn.btn-outline-dark.active {
    background-color: #ffc107 !important;
    color: #212529 !important;
    border-color: #ffc107 !important;
  }

  /* === Kolory wierszy listy wg dostępności === */
  .item-available  { background-color: #198754; color: #fff; } /* success */
  .item-unavailable{ background-color: #dc3545; color: #fff; } /* danger  */

  /* Badge na kontrastowym tle */
  .badge-contrast {
    background-color: rgba(255,255,255,.9);
    color: #212529;
  }
    </style>
    <!-- GÓRNE PRZYCISKI -->
    <div class="container mt-3">
        <div class="top-actions d-flex flex-wrap gap-2 justify-content-center">
            <a href="{% url 'kitchen-orders' %}"
               class="btn btn-outline-dark btn-lg {% if request.resolver_match.url_name == 'kitchen-orders' %}active{% endif %}">
                Zamówienia
            </a>
            <a href="{% url 'available' %}"
               class="btn btn-outline-dark btn-lg {% if request.resolver_match.url_name == 'available' %}active{% endif %}">
                Zmień status
            </a>
            <a href="{% url 'orders-history' %}"
               class="btn btn-outline-dark btn-lg {% if request.resolver_match.url_name == 'orders-history' %}active{% endif %}">
                Historia zamówień
            </a>
        </div>
    </div>
    <div class="container mt-4">
        <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-3">
            <h2 class="mb-0">Change Availability</h2>
            <!-- Szukajka -->
            <div class="ms-auto" style="min-width:280px; max-width:420px; flex:1;">
                <input id="filter-input"
                       type="search"
                       class="form-control form-control-lg"
                       placeholder="Szukaj pozycji po nazwie…"
                       aria-label="Szukaj pozycji po nazwie">
            </div>
        </div>
        <div class="list-group" id="items-list">
            {% for item in object_list %}
                <a href="{% url 'toggle-availability' item.id %}"
                   class="list-group-item list-group-item-action d-flex justify-content-between align-items-center {% if item.is_available %}item-available{% else %}item-unavailable{% endif %}">
                    <!-- NAZWA: dodajemy .item-name, żeby JS brał tekst z DOM -->
                    <span class="item-name fs-3 fw-semibold">{{ item.name }}</span>
                    {% if item.is_available %}
                        <span class="badge badge-contrast">Available</span>
                    {% else %}
                        <span class="badge badge-contrast">Unavailable</span>
                    {% endif %}
                </a>
            {% empty %}
                <p class="text-muted">No items found.</p>
            {% endfor %}
        </div>
        <div class="text-muted mt-2" id="visible-count" style="display:none;"></div>
    </div>
    <script>
  (function () {
    const input   = document.getElementById('filter-input');
    const list    = document.getElementById('items-list');
    const rows    = list ? Array.from(list.querySelectorAll('.list-group-item')) : [];
    const counter = document.getElementById('visible-count');

    // Fallback, gdyby normalize nie istniało (bardzo stare webview)
    const hasNormalize = !!(String.prototype.normalize);
    const fold = (s) => {
      s = (s || '').toString().toLowerCase().trim();
      if (!hasNormalize) return s;
      return s.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    };

    // Pobierz nazwę z DOM (tekst w .item-name)
    const getName = (el) => {
      const n = el.querySelector('.item-name');
      return n ? n.textContent : el.textContent || '';
    };

    // Preindeks: złożymy wersję "folded" w data-atrybucie
    rows.forEach(el => {
      el.dataset.nameFolded = fold(getName(el));
    });

    function applyFilter() {
      const q = fold(input ? input.value : '');
      let visible = 0;

      rows.forEach(el => {
        const match = !q || el.dataset.nameFolded.includes(q);
        el.classList.toggle('d-none', !match);
        if (match) visible++;
      });

      if (counter) {
        counter.style.display = '';
        counter.textContent = `Widoczne pozycje: ${visible} / ${rows.length}`;
      }
    }

    if (input) {
      input.addEventListener('input', applyFilter);
      // Na wszelki wypadek także po "change"
      input.addEventListener('change', applyFilter);
    }
    // Startowo
    applyFilter();
  })();
    </script>
{% endblock content %}
